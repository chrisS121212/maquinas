<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block titulo %}Panel{% endblock %}</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome 6 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
    <script src="/static/js/tu_script_que_usa_bootstrap.js"></script>

    <style>
        :root{
        --sidebar-w: 260px;
        --sidebar-bg: #0f0f0f; /* negro mate */
        --sidebar-text: #e9ecef;
        --sidebar-muted: #b9b9b9;
        --sidebar-hover: #1a1a1a;
        --sidebar-active: #0d6efd; /* azul bootstrap para activo */
        }
        body {
        min-height: 100vh;
        background: #000; /* fondo negro opaco del contenido (puedes cambiarlo) */
        }
    </style>
</head>
<body>
    <!-- Topbar para móvil -->
    <nav class="navbar navbar-dark bg-dark d-lg-none">
        <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar" aria-controls="mobileSidebar" aria-label="Abrir menú">
            <span class="navbar-toggler-icon"></span>
        </button>
        <span class="navbar-brand ms-2">Máquinas</span>
        </div>
    </nav>

    <!-- Sidebar fijo (desktop) -->
    <aside class="app-sidebar d-none d-lg-flex">
        <div class="brand-box d-flex align-items-center gap-3">
        <div class="user-avatar">
            <i class="fa-solid fa-user text-white-50"></i>
        </div>
        <div class="d-flex flex-column">
            <strong>{{ session['usuario'] }}</strong>
            <small class="text-secondary-emphasis" style="color: var(--sidebar-muted) !important;">{{ session['rol'] }}</small>
        </div>
        </div>
        <nav class="menu">
        <a class="nav-link" href="{{ url_for('inicio') }}">
            <i class="fa-solid fa-house"></i> <span>Inicio</span>
        </a>
        <a class="nav-link" href="{{ url_for('maquinas') }}">
            <i class="fa-solid fa-industry"></i> <span>Máquinas</span>
        </a>
        <a class="nav-link" href="{{ url_for('gastos') }}">
            <i class="fa-solid fa-wallet"></i> <span>Gastos</span>
        </a>
        <a class="nav-link" href="{{ url_for('cambio') }}">
            <i class="fa-solid fa-dollar-sign"></i> <span>Tipo de cambio</span>
        </a>
        {% if session.get('rol') == 'Admin' %}
        <a class="nav-link" href="{{ url_for('configuracion') }}">
            <i class="fa-solid fa-gear"></i> <span>Configuración</span>
        </a>
        {% else %}
        <!-- Botón visualmente apagado para usuarios no admin -->
        <a class="nav-link disabled text-muted" href="#" tabindex="-1" aria-disabled="true" title="Solo Admin">
            <i class="fa-solid fa-gear"></i>  <span>Configuración</span>
        </a>
        {% endif %}
        </nav>

        <div class="sidebar-footer">
        <a class="btn btn-logout" type="button" href="{{ url_for('logout') }}">
            <i class="fa-solid fa-right-from-bracket"></i>
            <span>Cerrar sesión</span>
        </a>
        </div>
    </aside>

    <!-- Sidebar móvil (offcanvas) -->
    <div class="offcanvas offcanvas-start text-bg-dark d-lg-none" tabindex="-1" id="mobileSidebar" aria-labelledby="mobileSidebarLabel" style="--bs-offcanvas-width: var(--sidebar-w); background:#0f0f0f;">
        <div class="offcanvas-header border-bottom border-secondary">
        <div class="d-flex align-items-center gap-3">
            <div class="user-avatar">
            <i class="fa-solid fa-user text-white-50"></i>
            </div>
            <div class="d-flex flex-column">
            <strong id="mobileSidebarLabel">Juan Pérez</strong>
            <small class="text-white-50">Administrador</small>
            </div>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
        <nav class="menu flex-grow-1">
            <a class="nav-link" href="{{ url_for('inicio') }}"><i class="fa-solid fa-house"></i> Inicio</a>
            <a class="nav-link" href="{{ url_for('maquinas') }}"><i class="fa-solid fa-industry"></i> Máquinas</a>
            <a class="nav-link" href="{{ url_for('gastos') }}"><i class="fa-solid fa-wallet"></i> Gastos</a>
            <a class="nav-link" href="{{ url_for('cambio') }}"><i class="fa-solid fa-dollar-sign"></i> Tipo de cambio</a>
            <a class="nav-link" href="{{ url_for('configuracion') }}"><i class="fa-solid fa-cog"></i> Configuración</a>
        </nav>
        <div class="sidebar-footer">
            <button class="btn btn-logout" type="button">
            <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
            </button>
        </div>
        </div>
    </div>

    <!-- Contenido -->
    <main class="app-content">
        <div class="container-fluid">
        <div class="card bg-dark border-0 shadow">
            <div class="card-body">
            {% block contenido %}
            {% endblock %}
            </div>
        </div>
        </div>
    </main>

    <!-- Toasts (esquina inferior derecha) -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 2000">
        <!-- Se crean dinámicamente vía JS -->
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <!-- (Opcional) Marca el link activo según ruta -->
    <script>
        // Ejemplo simple para marcar activo según URL
        const links = document.querySelectorAll('.menu .nav-link');
        links.forEach(a => {
        if (a.getAttribute('href') && a.getAttribute('href') !== '#' && location.pathname.startsWith(a.getAttribute('href'))) {
            links.forEach(l => l.classList.remove('active'));
            a.classList.add('active');
        }
        });
  </script>
</body>
</html>